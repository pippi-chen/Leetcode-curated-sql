-- 1294. Weather Type In Each Country 
-- Write an SQL query to find the type of weather in each country for November 2019.
-- The type of weather is Cold if the average weather_state is less than or equal 15, 
-- Hot if the average weather_state is greater than or equal 25 and Warm otherwise.

-- Create table
DROP TABLE COUNTRIES;
CREATE TABLE COUNTRIES(
 COUNTRY_ID INT,
 COUNTRY_NAME VARCHAR(20),
 PRIMARY KEY (COUNTRY_ID)
);
 
DROP TABLE WEATHER;
CREATE TABLE WEATHER(
 COUNTRY_ID INT,
 WEATHER_STATE VARCHAR(20),
 DAY DATE,
 PRIMARY KEY (COUNTRY_ID, DAY)
);
 
INSERT INTO COUNTRIES VALUES (2, 'USA');
INSERT INTO COUNTRIES VALUES (3, 'Australia');
INSERT INTO COUNTRIES VALUES (7, 'Peru');
INSERT INTO COUNTRIES VALUES (5, 'China');
INSERT INTO COUNTRIES VALUES (8, 'Morocco');
INSERT INTO COUNTRIES VALUES (9, 'Spain');

INSERT INTO WEATHER VALUES (2, 15, '2019-11-01');
INSERT INTO WEATHER VALUES (2, 12, '2019-10-28');
INSERT INTO WEATHER VALUES (2, 12, '2019-10-27');
INSERT INTO WEATHER VALUES (3, -2, '2019-11-10');
INSERT INTO WEATHER VALUES (3, 0,  '2019-11-11');
INSERT INTO WEATHER VALUES (3, 3,  '2019-11-12');
INSERT INTO WEATHER VALUES (5, 16, '2019-11-07');
INSERT INTO WEATHER VALUES (5, 18, '2019-11-09');
INSERT INTO WEATHER VALUES (5, 21, '2019-11-23');
INSERT INTO WEATHER VALUES (7, 25, '2019-11-28');
INSERT INTO WEATHER VALUES (7, 22, '2019-12-01');
INSERT INTO WEATHER VALUES (7, 20, '2019-12-02');
INSERT INTO WEATHER VALUES (8, 25, '2019-11-05');
INSERT INTO WEATHER VALUES (8, 27, '2019-11-15');
INSERT INTO WEATHER VALUES (8, 31, '2019-11-25');
INSERT INTO WEATHER VALUES (9, 7,  '2019-10-23');
INSERT INTO WEATHER VALUES (9, 3,  '2019-12-23');
COMMIT;

-- Solution
SELECT C.COUNTRY_NAME, (
	CASE WHEN (SUM(W.WEATHER_STATE) / COUNT(W.`DAY`)) <= 15 THEN "COLD"
    WHEN (SUM(W.WEATHER_STATE) / COUNT(W.`DAY`)) >= 25 THEN "HOT"
    ELSE "WARM" 
    END) WEATHER_TYPE
FROM COUNTRIES C, WEATHER W
WHERE C.COUNTRY_ID = W.COUNTRY_ID
	AND 
    W.`DAY` BETWEEN '2019-11-01' AND '2019-11-30'
GROUP BY C.COUNTRY_ID;




